# OKXTrader 小程序 - 配置和启动指南

## ✅ 已配置的合法域名

- **request合法域名**: `https://ly.ddg.org.cn`
- **socket合法域名**: `wss://ly.ddg.org.cn`

## 🚀 快速启动步骤

### 1. 打开微信开发者工具

确保使用最新版本的微信开发者工具

### 2. 导入项目

- 项目路径: `/Users/chenlaiyi/Oyi/OKly-program/miniprogram`
- AppID: `wxc54ef555c258bbf6`（或使用测试号）

### 3. 编译运行

1. 点击工具栏的"编译"按钮
2. 查看模拟器中的效果
3. 如需真机调试，点击"预览"按钮

## 📋 项目配置检查清单

### ✅ 已完成配置

- [x] API基础URL: `https://ly.ddg.org.cn/api`
- [x] WebSocket URL: `wss://ly.ddg.org.cn`
- [x] 合法域名配置完成
- [x] TypeScript编译器配置
- [x] Less样式编译器配置
- [x] 页面路由配置（9个页面）
- [x] TabBar配置（5个Tab）

### ⏳ 待配置项

- [ ] TabBar图标（可选）
- [ ] 小程序隐私协议
- [ ] 用户隐私保护指引
- [ ] 业务域名补充说明

## 🔧 开发者工具设置

### 基本设置

在微信开发者工具中：

1. **详情 → 本地设置**
   - ✅ 不勾选"不校验合法域名..."（因为已配置）
   - ✅ 不勾选"不校验远程证书..."（生产环境必须）

2. **详情 → 域名信息**
   - request域名: `https://ly.ddg.org.cn` ✅
   - socket域名: `wss://ly.ddg.org.cn` ✅

### 调试设置

1. 打开"调试模式"
2. 打开"Console"查看日志
3. 打开"Network"查看API请求

## 📊 API测试

小程序会调用以下API端点：

```typescript
// 获取行情
GET https://ly.ddg.org.cn/api/markets

// 获取K线
GET https://ly.ddg.org.cn/api/candles?symbol=ETH-USDT-SWAP&limit=100

// 执行交易
POST https://ly.ddg.org.cn/api/trade
Body: { symbol: "ETH-USDT-SWAP", side: "long", size: 1 }

// 获取AI分析
GET https://ly.ddg.org.cn/api/ai/analysis/latest?symbol=ETH-USDT-SWAP

// 获取持仓
GET https://ly.ddg.org.cn/api/positions

// 切换自动交易
POST https://ly.ddg.org.cn/api/autotrading/toggle
Body: { enabled: true }
```

## 🧪 功能测试

### 首页测试

1. **行情卡片**
   - 应该显示6个热门交易对
   - 价格和涨跌幅实时更新
   - 点击卡片跳转到行情页面

2. **AI分析**
   - 显示AI建议
   - 显示置信度
   - 点击查看详情

3. **持仓列表**
   - 显示当前持仓
   - 盈亏计算正确
   - 颜色区分（绿涨红跌）

4. **自动交易开关**
   - 可以切换开关
   - 状态持久化

### 交易页面测试

1. **价格显示**
   - 显示当前交易对
   - 实时价格更新

2. **交易按钮**
   - 点击"做多"弹出确认框
   - 确认后执行下单
   - 显示成功/失败提示

3. **持仓列表**
   - 显示所有持仓
   - 实时更新盈亏

## ⚠️ 常见问题

### 1. API请求失败

**错误信息**: `request:fail url not in domain list`

**解决方案**:
- 确认已在微信公众平台配置合法域名
- 确认使用HTTPS协议
- 检查域名是否正确

### 2. SSL证书错误

**错误信息**: `request:fail (anonymous) : request : fail ssl hand shake error`

**解决方案**:
- 确认服务器SSL证书有效
- 在开发环境可临时勾选"不校验远程证书"
- 生产环境必须使用有效证书

### 3. 编译错误

**错误信息**: TypeScript编译错误

**解决方案**:
```bash
cd /Users/chenlaiyi/Oyi/OKly-program/miniprogram
npm install
```

### 4. 页面空白

**可能原因**:
- API数据加载失败
- JavaScript运行时错误
- 页面路径错误

**排查步骤**:
1. 打开Console查看错误信息
2. 打开Network查看API请求
3. 检查app.json中的页面路径

## 📱 真机预览

### 生成预览码

1. 点击工具栏"预览"按钮
2. 扫码在微信中打开
3. 查看实际效果

### 真机调试

1. 点击"真机调试"按钮
2. 扫码在微信中打开
3. 可以实时查看日志和性能

## 🚢 发布流程

### 1. 上传代码

1. 点击工具栏"上传"按钮
2. 填写版本号和备注
3. 点击"上传"

### 2. 提交审核

1. 登录微信公众平台
2. 进入"版本管理"
3. 提交审核
4. 填写审核信息

### 3. 发布上线

1. 审核通过后
2. 点击"全量发布"
3. 等待发布完成

## 📊 版本管理

### 当前版本
- 版本号: `1.0.0`
- 基础库版本: `2.32.3`
- TypeScript: ✅
- Less: ✅

### 版本规划
- v1.0.0-alpha: 基础框架完成（当前）
- v1.0.0-beta: 完善核心功能
- v1.0.0: 正式版发布

## 🔐 安全配置

### 服务器配置

1. **HTTPS证书**: 必须有效
2. **域名备案**: 已完成
3. **API鉴权**: 按需添加token验证

### 小程序配置

1. **域名白名单**: 已配置
2. **业务域名**: 已配置
3. **用户隐私**: 需要配置

## 📈 性能监控

### 开发阶段

1. 使用"性能"面板监控
2. 关注页面加载时间
3. 监控API响应时间

### 生产环境

1. 微信小程序后台监控
2. 错误日志收集
3. 用户反馈收集

## 🎯 下一步工作

### 立即可以做的
- [x] 基础框架搭建
- [x] API集成
- [x] 核心页面开发
- [ ] 在开发者工具中测试
- [ ] 真机预览测试

### 需要完善的
- [ ] 集成echarts K线图
- [ ] WebSocket实时更新
- [ ] 策略编辑详细功能
- [ ] 添加TabBar图标
- [ ] 优化用户体验

### 优化项
- [ ] 性能优化
- [ ] 错误处理完善
- [ ] 加载状态优化
- [ ] 空状态页面

## 📞 技术支持

遇到问题时：

1. **查看文档**
   - 微信小程序官方文档
   - 项目README.md
   - 项目DEVELOPMENT.md

2. **检查配置**
   - 合法域名配置
   - 服务器状态
   - 网络连接

3. **查看日志**
   - Console日志
   - Network请求
   - 真机调试日志

## ✨ 总结

小程序端已完成基础框架开发，所有核心页面已创建，API服务层已就绪。由于已配置合法域名，可以直接在微信开发者工具中编译运行，无需特殊配置。

现在可以：
1. ✅ 在开发者工具中查看效果
2. ✅ 测试API数据加载
3. ✅ 真机预览测试
4. ⏳ 继续完善功能细节

祝开发顺利！🎉
