<!--pages/index/index.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨åŒºåŸŸ -->
  <view class="header">
    <view class="header-content">
      <view class="title">OKly</view>
      <view class="subtitle">æ™ºèƒ½åŠ å¯†è´§å¸äº¤æ˜“ç³»ç»Ÿ</view>
    </view>
  </view>

  <!-- è´¦å·ä¿¡æ¯å¡ç‰‡ -->
  <view class="account-card">
    <view class="account-header">
      <view class="account-icon">ğŸ‘¤</view>
      <view class="account-info">
        <view class="account-name">{{currentAccount.name || 'æ¨¡æ‹Ÿè´¦å·'}}</view>
        <view class="account-type">{{currentAccount.isSimulation ? 'æ¨¡æ‹Ÿäº¤æ˜“' : 'å®ç›˜äº¤æ˜“'}}</view>
      </view>
    </view>
    <view class="account-actions">
      <view class="action-btn" bindtap="goToAccount">
        <text>ç®¡ç†è´¦å·</text>
      </view>
    </view>
  </view>

  <!-- è¡Œæƒ…æ¦‚è§ˆå¡ç‰‡ -->
  <view class="section">
    <view class="section-header">
      <view class="section-icon">ğŸ“ˆ</view>
      <view class="section-title">çƒ­é—¨è¡Œæƒ…</view>
      <view class="section-more" bindtap="goToMarket">æ›´å¤š â†’</view>
    </view>
    <scroll-view scroll-x class="market-scroll" enable-flex show-scrollbar="{{false}}">
      <view class="market-card" wx:for="{{markets}}" wx:key="inst_id" bindtap="selectMarket" data-symbol="{{item.inst_id}}">
        <view class="market-symbol">{{item.inst_id}}</view>
        <view class="market-price {{item.trend}}">{{item.price}}</view>
        <view class="market-change {{item.trend}}">{{item.change}}</view>
      </view>
    </scroll-view>
  </view>

  <!-- å¿«é€Ÿæ“ä½œ -->
  <view class="section">
    <view class="section-header">
      <view class="section-icon">âš¡</view>
      <view class="section-title">å¿«é€Ÿæ“ä½œ</view>
    </view>
    <view class="quick-actions">
      <view class="action-item" bindtap="goToTrading">
        <view class="action-icon-wrapper trading">
          <text class="action-icon">ğŸ’±</text>
        </view>
        <view class="action-text">äº¤æ˜“</view>
      </view>
      <view class="action-item" bindtap="goToMarket">
        <view class="action-icon-wrapper market">
          <text class="action-icon">ğŸ“Š</text>
        </view>
        <view class="action-text">è¡Œæƒ…</view>
      </view>
      <view class="action-item" bindtap="goToMonitor">
        <view class="action-icon-wrapper monitor">
          <text class="action-icon">ğŸ¯</text>
        </view>
        <view class="action-text">ç›‘æ§</view>
      </view>
      <view class="action-item" bindtap="goToAI">
        <view class="action-icon-wrapper ai">
          <text class="action-icon">ğŸ¤–</text>
        </view>
        <view class="action-text">AIåˆ†æ</view>
      </view>
    </view>
  </view>

  <!-- AIåˆ†æé¢„è§ˆ -->
  <view class="section" wx:if="{{aiAnalysis}}">
    <view class="section-header">
      <view class="section-icon">ğŸ¤–</view>
      <view class="section-title">AIåˆ†æå»ºè®®</view>
      <view class="section-more" bindtap="goToAI">è¯¦æƒ… â†’</view>
    </view>
    <view class="ai-card">
      <view class="ai-header">
        <view class="ai-signal-badge {{aiAnalysis.signal_type}}">
          <text class="signal-icon">{{aiAnalysis.signal_type === 'long' ? 'ğŸ“ˆ' : 'ğŸ“‰'}}</text>
          <text class="signal-text">{{aiAnalysis.signal_type === 'long' ? 'åšå¤šå»ºè®®' : 'åšç©ºå»ºè®®'}}</text>
        </view>
        <view class="ai-confidence">
          <text class="confidence-label">ç½®ä¿¡åº¦</text>
          <text class="confidence-value">{{aiAnalysis.confidence}}%</text>
        </view>
      </view>
      <view class="ai-content">
        <view class="ai-reasoning">{{aiAnalysis.reasoning}}</view>
      </view>
      <view class="ai-footer">
        <view class="ai-time">
          <text class="time-icon">ğŸ•</text>
          <text>{{formatTime(aiAnalysis.timestamp)}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æŒä»“æ¦‚è§ˆ -->
  <view class="section" wx:if="{{positions.length > 0}}">
    <view class="section-header">
      <view class="section-icon">ğŸ’¼</view>
      <view class="section-title">å½“å‰æŒä»“</view>
      <view class="section-more" bindtap="goToHistory">è¯¦æƒ… â†’</view>
    </view>
    <view class="position-list">
      <view class="position-item" wx:for="{{positions}}" wx:key="id" bindtap="viewPosition" data-id="{{item.id}}">
        <view class="pos-header">
          <view class="pos-symbol">{{item.symbol}}</view>
          <view class="pos-side {{item.side}}">{{item.side === 'long' ? 'åšå¤š' : 'åšç©º'}}</view>
        </view>
        <view class="pos-body">
          <view class="pos-row">
            <text class="pos-label">å…¥åœºä»·</text>
            <text class="pos-value">{{item.entryPrice}}</text>
          </view>
          <view class="pos-row">
            <text class="pos-label">æœªå®ç°ç›ˆäº</text>
            <text class="pos-value {{item.pnlClass}}">{{item.pnlDisplay}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- è‡ªåŠ¨äº¤æ˜“çŠ¶æ€ -->
  <view class="section">
    <view class="section-header">
      <view class="section-icon">ğŸ”„</view>
      <view class="section-title">è‡ªåŠ¨äº¤æ˜“</view>
    </view>
    <view class="auto-trade-card">
      <view class="auto-info">
        <view class="auto-status-badge {{autoTradingEnabled ? 'enabled' : 'disabled'}}">
          <text class="status-icon">{{autoTradingEnabled ? 'âœ…' : 'âŒ'}}</text>
          <text class="status-text">{{autoTradingEnabled ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨'}}</text>
        </view>
        <view class="auto-desc">AIç­–ç•¥è‡ªåŠ¨æ‰§è¡Œäº¤æ˜“</view>
      </view>
      <switch checked="{{autoTradingEnabled}}" bindchange="toggleAutoTrading" color="#667eea" class="auto-switch"/>
    </view>
  </view>

  <!-- åº•éƒ¨è¯´æ˜ -->
  <view class="footer">
    <view class="footer-text">OKly v1.0.0</view>
    <view class="footer-text">æ•°æ®æ¥æºäº OKX å…¬å¼€ API</view>
  </view>
</view>
