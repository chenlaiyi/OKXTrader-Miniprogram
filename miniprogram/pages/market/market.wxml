<!--pages/market/market.wxml-->
<view class="container">
  <!-- å½“å‰é€‰ä¸­äº¤æ˜“å¯¹è¯¦æƒ…å¡ç‰‡ (iOSé£æ ¼) -->
  <view class="pair-detail-card" wx:if="{{selectedPair && !loading}}">
    <view class="pair-header">
      <view class="pair-info">
        <text class="pair-name">{{selectedPair.baseCcy || '--'}}</text>
        <text class="pair-price {{priceChangeClass}}">{{currentPrice}}</text>
      </view>
      <view class="pair-change">
        <text class="change-percent {{priceChangeClass}}">{{priceChangePercentDisplay}}</text>
        <text class="change-amount {{priceChangeClass}}">{{priceChangeDisplay}}</text>
      </view>
    </view>
    <view class="pair-stats">
      <view class="stat-item">
        <text class="stat-label">24h æœ€é«˜</text>
        <text class="stat-value">{{high24h}}</text>
      </view>
      <view class="stat-item">
        <text class="stat-label">24h æœ€ä½</text>
        <text class="stat-value">{{low24h}}</text>
      </view>
      <view class="stat-item">
        <text class="stat-label">æˆäº¤é‡</text>
        <text class="stat-value">{{volume24h}}</text>
      </view>
    </view>
  </view>

  <!-- Kçº¿å›¾åŒºåŸŸ -->
  <view class="chart-section" wx:if="{{!loading}}">
    <!-- æ—¶é—´å‘¨æœŸé€‰æ‹©å™¨ -->
    <view class="time-period-selector">
      <view
        class="period-item {{timePeriod === '1m' ? 'active' : ''}}"
        bindtap="switchTimePeriod"
        data-period="1m"
      >1m</view>
      <view
        class="period-item {{timePeriod === '5m' ? 'active' : ''}}"
        bindtap="switchTimePeriod"
        data-period="5m"
      >5m</view>
      <view
        class="period-item {{timePeriod === '15m' ? 'active' : ''}}"
        bindtap="switchTimePeriod"
        data-period="15m"
      >15m</view>
      <view
        class="period-item {{timePeriod === '1H' ? 'active' : ''}}"
        bindtap="switchTimePeriod"
        data-period="1H"
      >1H</view>
      <view
        class="period-item {{timePeriod === '4H' ? 'active' : ''}}"
        bindtap="switchTimePeriod"
        data-period="4H"
      >4H</view>
      <view
        class="period-item {{timePeriod === '1D' ? 'active' : ''}}"
        bindtap="switchTimePeriod"
        data-period="1D"
      >1D</view>
    </view>

    <!-- Kçº¿å›¾ç»„ä»¶ -->
    <candlestick-chart
      candles="{{candleData}}"
      sar-data="{{sarData}}"
      macd-data="{{macdData}}"
      current-price="{{currentPrice}}"
      height="500"
    />

    <!-- åŠ è½½æç¤º -->
    <view class="chart-loading" wx:if="{{loadingCandles}}">
      <text>åŠ è½½Kçº¿æ•°æ®ä¸­...</text>
    </view>
  </view>

  <!-- åˆ†éš”çº¿ -->
  <view class="divider"></view>

  <!-- è¡Œæƒ…åˆ—è¡¨ (iOSé£æ ¼ - æ— è¡¨å¤´) -->
  <view class="market-list" wx:if="{{!loading}}">
    <view
      class="market-row {{item.instId === selectedPair.instId ? 'selected' : ''}}"
      wx:for="{{filteredMarkets}}"
      wx:key="instId"
      bindtap="selectPair"
      data-pair="{{item}}"
    >
      <view class="pair-column">
        <text class="pair-ccy">{{item.baseCcy}}</text>
        <text class="quote-ccy">{{item.quoteCcy}}</text>
      </view>
      <view class="pair-column-right">
        <text class="price-text">{{item.last}}</text>
        <text class="change-percent {{item.changeClass}}">{{item.changeDisplay}}</text>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{filteredMarkets.length === 0 && !loading}}">
    <text class="empty-icon">ğŸ“Š</text>
    <text class="empty-text">æš‚æ— è¡Œæƒ…æ•°æ®</text>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view class="empty-state" wx:if="{{loading}}">
    <text class="empty-text">åŠ è½½è¡Œæƒ…æ•°æ®ä¸­...</text>
  </view>
</view>
