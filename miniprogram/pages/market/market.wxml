<!--pages/market/market.wxml-->
<view class="container">
  <!-- æœç´¢æ  -->
  <view class="search-bar">
    <view class="search-input-wrapper">
      <text class="search-icon">ğŸ”</text>
      <input
        class="search-input"
        type="text"
        placeholder="æœç´¢äº¤æ˜“å¯¹"
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        placeholder-class="search-placeholder"
      />
      <text class="clear-icon" wx:if="{{searchKeyword}}" bindtap="clearSearch">âœ•</text>
    </view>
  </view>

  <!-- åˆ†ç±»æ ‡ç­¾ -->
  <view class="category-tabs">
    <view
      class="tab-item {{activeCategory === 'all' ? 'active' : ''}}"
      bindtap="switchCategory"
      data-category="all"
    >
      <text class="tab-text">å…¨éƒ¨</text>
    </view>
    <view
      class="tab-item {{activeCategory === 'spot' ? 'active' : ''}}"
      bindtap="switchCategory"
      data-category="spot"
    >
      <text class="tab-text">ç°è´§</text>
    </view>
    <view
      class="tab-item {{activeCategory === 'swap' ? 'active' : ''}}"
      bindtap="switchCategory"
      data-category="swap"
    >
      <text class="tab-text">åˆçº¦</text>
    </view>
  </view>

  <!-- æ’åºæ  -->
  <view class="sort-bar">
    <view class="sort-item" bindtap="sortMarkets" data-sort="name">
      <text class="sort-text">åç§°</text>
      <view class="sort-icon-wrapper">
        <text class="sort-arrow {{sortField === 'name' && sortOrder === 'asc' ? 'active' : ''}}">â–²</text>
        <text class="sort-arrow {{sortField === 'name' && sortOrder === 'desc' ? 'active' : ''}}">â–¼</text>
      </view>
    </view>
    <view class="sort-item" bindtap="sortMarkets" data-sort="price">
      <text class="sort-text">ä»·æ ¼</text>
      <view class="sort-icon-wrapper">
        <text class="sort-arrow {{sortField === 'price' && sortOrder === 'asc' ? 'active' : ''}}">â–²</text>
        <text class="sort-arrow {{sortField === 'price' && sortOrder === 'desc' ? 'active' : ''}}">â–¼</text>
      </view>
    </view>
    <view class="sort-item" bindtap="sortMarkets" data-sort="change">
      <text class="sort-text">æ¶¨è·Œå¹…</text>
      <view class="sort-icon-wrapper">
        <text class="sort-arrow {{sortField === 'change' && sortOrder === 'asc' ? 'active' : ''}}">â–²</text>
        <text class="sort-arrow {{sortField === 'change' && sortOrder === 'desc' ? 'active' : ''}}">â–¼</text>
      </view>
    </view>
    <view class="sort-item" bindtap="sortMarkets" data-sort="volume">
      <text class="sort-text">æˆäº¤é‡</text>
      <view class="sort-icon-wrapper">
        <text class="sort-arrow {{sortField === 'volume' && sortOrder === 'asc' ? 'active' : ''}}">â–²</text>
        <text class="sort-arrow {{sortField === 'volume' && sortOrder === 'desc' ? 'active' : ''}}">â–¼</text>
      </view>
    </view>
  </view>

  <!-- è¡Œæƒ…åˆ—è¡¨ -->
  <scroll-view
    class="market-list"
    scroll-y
    refresher-enabled
    refresher-triggered="{{refreshing}}"
    bindrefresherrefresh="onRefresh"
  >
    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{filteredMarkets.length === 0}}" class="empty-state">
      <view class="empty-icon">ğŸ“Š</view>
      <view class="empty-text">{{searchKeyword ? 'æœªæ‰¾åˆ°ç›¸å…³äº¤æ˜“å¯¹' : 'æš‚æ— è¡Œæƒ…æ•°æ®'}}</view>
      <view class="empty-hint" wx:if="{{searchKeyword}}">å°è¯•æœç´¢å…¶ä»–å¸ç§</view>
    </view>

    <!-- è¡Œæƒ…å¡ç‰‡åˆ—è¡¨ -->
    <view class="market-card-list">
      <view
        class="market-card"
        wx:for="{{filteredMarkets}}"
        wx:key="inst_id"
        bindtap="selectMarket"
        data-symbol="{{item.inst_id}}"
      >
        <view class="card-left">
          <view class="coin-info">
            <text class="coin-symbol">{{item.inst_id}}</text>
            <text class="coin-name">{{item.name || 'BTC'}}</text>
          </view>
          <view class="coin-volume">
            <text class="volume-label">24hé‡</text>
            <text class="volume-value">{{item.volume24h || '--'}}</text>
          </view>
        </view>

        <view class="card-center">
          <view class="price-info">
            <text class="price {{item.trend}}">{{item.price}}</text>
          </view>
          <view class="price-change {{item.trend}}">
            <text class="change-icon">{{item.trend === 'up' ? 'â–²' : item.trend === 'down' ? 'â–¼' : 'âˆ’'}}</text>
            <text class="change-value">{{item.change}}</text>
          </view>
        </view>

        <view class="card-right">
          <view class="quick-actions">
            <button class="action-btn buy-btn" catchtap="quickTrade" data-symbol="{{item.inst_id}}" data-side="long">
              ä¹°å…¥
            </button>
            <button class="action-btn sell-btn" catchtap="quickTrade" data-symbol="{{item.inst_id}}" data-side="short">
              å–å‡º
            </button>
          </view>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- åº•éƒ¨æç¤º -->
  <view class="footer-hint">
    <text class="hint-text">æ•°æ®æ¥æºäº OKX å…¬å¼€ API</text>
    <text class="hint-time">æ›´æ–°æ—¶é—´: {{updateTime}}</text>
  </view>
</view>
