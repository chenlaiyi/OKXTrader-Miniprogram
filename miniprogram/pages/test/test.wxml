<view class="container">
  <view class="header">
    <text class="title">🧪 API测试页面</text>
    <text class="subtitle">验证GLM和OKX API对接状态</text>
  </view>

  <view class="info">
    <text class="info-text">API地址: https://ly.ddg.org.cn/api</text>
    <text class="info-text">状态: {{isTesting ? '测试中...' : '就绪'}}</text>
  </view>

  <view class="actions">
    <button class="btn-test" bindtap="runAllTests" disabled="{{loading}}">
      {{loading ? '测试中...' : '🔄 开始测试'}}
    </button>
  </view>

  <view class="results">
    <view class="section-title">测试结果 ({{testResults.length}})</view>

    <view class="test-item" wx:for="{{testResults}}" wx:key="name">
      <view class="test-header">
        <text class="test-name">{{item.name}}</text>
        <text class="test-status {{item.status}}">
          {{item.status === 'success' ? '✅ 成功' : '❌ 失败'}}
        </text>
      </view>

      <view class="test-details" wx:if="{{item.status === 'success'}}">
        <text class="test-duration">{{item.duration}}</text>
      </view>

      <view class="test-error" wx:else>
        <text class="error-text">错误: {{item.error}}</text>
      </view>
    </view>

    <view class="empty" wx:if="{{testResults.length === 0 && !loading}}">
      <text>点击上方按钮开始测试</text>
    </view>

    <view class="loading" wx:if="{{loading}}">
      <text>正在测试API接口...</text>
    </view>
  </view>

  <view class="tips">
    <view class="tip-title">💡 提示</view>
    <text class="tip-text">• 服务器连接: 测试后端服务器是否在线</text>
    <text class="tip-text">• GLM Chat API: 测试智谱AI对话接口</text>
    <text class="tip-text">• OKX余额API: 测试账户余额查询</text>
    <text class="tip-text">• OKX持仓API: 测试持仓信息查询</text>
    <text class="tip-text">• AI分析API: 测试市场分析接口</text>
  </view>

  <view class="log-section" wx:if="{{logs.length > 0}}">
    <view class="section-title">测试日志</view>
    <view class="log-list">
      <view class="log-item {{item.type}}" wx:for="{{logs}}" wx:key="time" wx:for-item="log">
        <text class="log-time">[{{log.time}}]</text>
        <text class="log-message">{{log.message}}</text>
      </view>
    </view>
  </view>
</view>
