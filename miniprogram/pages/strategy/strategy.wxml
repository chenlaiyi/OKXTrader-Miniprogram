<!--pages/strategy/strategy.wxml-->
<!-- WXS å·¥å…·å‡½æ•° -->
<wxs module="utils">
module.exports = {
  round: function(num) {
    return Math.round(num);
  },
  toFixed: function(num, digits) {
    return num.toFixed(digits);
  },
  multiply: function(a, b) {
    return a * b;
  }
}
</wxs>

<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">âš™ï¸ è‡ªåŠ¨äº¤æ˜“é…ç½®</text>
    <text class="page-subtitle">è®¾ç½®AIåˆ†æå’Œè‡ªåŠ¨äº¤æ˜“å‚æ•°</text>
  </view>

  <!-- è‡ªåŠ¨äº¤æ˜“å¼€å…³ -->
  <view class="section-card">
    <view class="section-header">
      <text class="section-title">ğŸ¤– è‡ªåŠ¨äº¤æ˜“</text>
    </view>
    <view class="switch-row">
      <view class="switch-info">
        <text class="switch-label">å¯ç”¨è‡ªåŠ¨äº¤æ˜“</text>
        <text class="switch-desc">AIå°†è‡ªåŠ¨åˆ†æå¹¶æ‰§è¡Œäº¤æ˜“</text>
      </view>
      <switch checked="{{autoTradeEnabled}}" bindchange="toggleAutoTrade" color="#af52de"/>
    </view>
    
    <!-- äº¤æ˜“ç»Ÿè®¡ -->
    <view class="stats-row" wx:if="{{autoTradeEnabled}}">
      <view class="stat-item">
        <text class="stat-value">{{stats.totalTrades}}</text>
        <text class="stat-label">æ€»äº¤æ˜“</text>
      </view>
      <view class="stat-item green">
        <text class="stat-value">{{stats.winTrades}}</text>
        <text class="stat-label">ç›ˆåˆ©</text>
      </view>
      <view class="stat-item red">
        <text class="stat-value">{{stats.lossTrades}}</text>
        <text class="stat-label">äºæŸ</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{stats.winRate}}%</text>
        <text class="stat-label">èƒœç‡</text>
      </view>
    </view>
  </view>

  <!-- äº¤æ˜“å¯¹é€‰æ‹© -->
  <view class="section-card">
    <view class="section-header">
      <text class="section-title">ğŸ“Š äº¤æ˜“å¯¹</text>
    </view>
    <picker mode="selector" range="{{symbolList}}" value="{{symbolIndex}}" bindchange="onSymbolChange">
      <view class="picker-row">
        <text class="picker-label">å½“å‰äº¤æ˜“å¯¹</text>
        <view class="picker-value-wrap">
          <text class="picker-value">{{config.symbol}}</text>
          <text class="picker-arrow">â€º</text>
        </view>
      </view>
    </picker>
  </view>

  <!-- åˆ†æå‚æ•° -->
  <view class="section-card">
    <view class="section-header">
      <text class="section-title">ğŸ¯ åˆ†æå‚æ•°</text>
    </view>
    
    <!-- åˆ†æå†·å´æ—¶é—´ -->
    <view class="slider-row">
      <view class="slider-header">
        <text class="slider-label">å†·å´æ—¶é—´</text>
        <text class="slider-value">{{config.cooldownSeconds}}ç§’</text>
      </view>
      <slider min="30" max="300" step="10" value="{{config.cooldownSeconds}}" bindchange="onCooldownChange" activeColor="#af52de" block-size="20"/>
      <text class="slider-hint">ä¸¤æ¬¡äº¤æ˜“ä¹‹é—´çš„æœ€å°é—´éš”</text>
    </view>
  </view>

  <!-- é£æ§å‚æ•° -->
  <view class="section-card">
    <view class="section-header">
      <text class="section-title">ğŸ›¡ï¸ é£æ§å‚æ•°</text>
    </view>
    
    <!-- æ­¢ç›ˆ -->
    <view class="slider-row">
      <view class="slider-header">
        <text class="slider-label green-text">æ­¢ç›ˆæ¯”ä¾‹</text>
        <text class="slider-value green-text">{{utils.toFixed(utils.multiply(config.takeProfitPercent, 100), 1)}}%</text>
      </view>
      <slider min="5" max="1000" step="5" value="{{utils.multiply(config.takeProfitPercent, 100)}}" bindchange="onTakeProfitChange" activeColor="#34c759" block-size="20"/>
    </view>
    
    <!-- æ­¢æŸ -->
    <view class="slider-row">
      <view class="slider-header">
        <text class="slider-label red-text">æ­¢æŸæ¯”ä¾‹</text>
        <text class="slider-value red-text">{{utils.toFixed(utils.multiply(config.stopLossPercent, 100), 1)}}%</text>
      </view>
      <slider min="2" max="500" step="2" value="{{utils.multiply(config.stopLossPercent, 100)}}" bindchange="onStopLossChange" activeColor="#ff3b30" block-size="20"/>
    </view>

    <!-- ä»“ä½æ¯”ä¾‹ -->
    <view class="slider-row">
      <view class="slider-header">
        <text class="slider-label">ä»“ä½æ¯”ä¾‹</text>
        <text class="slider-value">{{utils.round(utils.multiply(config.positionSize, 100))}}%</text>
      </view>
      <slider min="10" max="100" step="5" value="{{utils.multiply(config.positionSize, 100)}}" bindchange="onPositionSizeChange" activeColor="#af52de" block-size="20"/>
      <text class="slider-hint">æ¯æ¬¡äº¤æ˜“ä½¿ç”¨çš„è´¦æˆ·ä½™é¢æ¯”ä¾‹</text>
    </view>

    <!-- æœ€å¤§æŒä»“æ•° -->
    <view class="slider-row">
      <view class="slider-header">
        <text class="slider-label">æœ€å¤§æŒä»“æ•°</text>
        <text class="slider-value">{{config.maxPositions}}</text>
      </view>
      <slider min="1" max="10" step="1" value="{{config.maxPositions}}" bindchange="onMaxPositionsChange" activeColor="#af52de" block-size="20"/>
    </view>
  </view>

  <!-- ä¿å­˜æŒ‰é’® -->
  <view class="save-section">
    <button class="save-btn" bindtap="saveConfig" loading="{{saving}}">
      <text class="save-icon" wx:if="{{!saving}}">ğŸ’¾</text>
      <text class="save-text">{{saving ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜é…ç½®'}}</text>
    </button>
  </view>

  <!-- åº•éƒ¨å®‰å…¨åŒº -->
  <view class="safe-bottom"></view>
</view>
