<!--pages/chat/chat.wxml-->
<view class="chat-container">
  <!-- èŠå¤©æ¶ˆæ¯åˆ—è¡¨ -->
  <scroll-view
    class="message-scroll"
    scroll-y
    scroll-into-view="{{toView}}"
    scroll-with-animation
  >
    <!-- ç©ºçŠ¶æ€æç¤º -->
    <view class="empty-state" wx:if="{{messages.length === 0}}">
      <text class="empty-icon">ğŸ§ </text>
      <text class="empty-title">AI äº¤æ˜“åŠ©æ‰‹</text>
      <text class="empty-subtitle">æˆ‘å¯ä»¥å¸®æ‚¨æŸ¥è¯¢ä½™é¢ã€åˆ†æè¡Œæƒ…ã€æ‰§è¡Œäº¤æ˜“</text>
    </view>

    <!-- æ¶ˆæ¯åˆ—è¡¨ -->
    <view class="message-list">
      <view
        class="message-item {{item.role}}"
        id="msg-{{index}}"
        wx:for="{{messages}}"
        wx:key="id"
      >
        <!-- AI æ¶ˆæ¯ -->
        <view class="message-content assistant" wx:if="{{item.role === 'assistant'}}">
          <view class="avatar assistant-avatar">
            <text class="avatar-icon">ğŸ§ </text>
          </view>
          <view class="message-right">
            <view class="bubble assistant-bubble">
              <text class="bubble-text">{{item.content}}</text>
            </view>
            <!-- æ‰§è¡Œç»“æœå¡ç‰‡ -->
            <view class="execution-card" wx:if="{{item.executionResult}}">
              <view class="execution-header">
                <text class="execution-icon">âœ“</text>
                <text class="execution-title">æ‰§è¡Œç»“æœ</text>
              </view>
              <text class="result-content">{{item.executionResult}}</text>
            </view>
            <text class="message-time">{{item.time}}</text>
          </view>
        </view>

        <!-- ç”¨æˆ·æ¶ˆæ¯ -->
        <view class="message-content user" wx:else>
          <view class="message-left">
            <text class="message-time">{{item.time}}</text>
            <view class="bubble user-bubble">
              <text class="bubble-text">{{item.content}}</text>
            </view>
          </view>
          <view class="avatar user-avatar">
            <text class="avatar-icon">ğŸ‘¤</text>
          </view>
        </view>
      </view>

      <!-- å¤„ç†ä¸­æŒ‡ç¤ºå™¨ -->
      <view class="typing-indicator" wx:if="{{isProcessing}}">
        <view class="typing-dots">
          <view class="dot"></view>
          <view class="dot"></view>
          <view class="dot"></view>
        </view>
        <text class="typing-text">AI æ­£åœ¨æ€è€ƒ...</text>
      </view>
    </view>
  </scroll-view>

  <!-- å¿«æ·æŒ‡ä»¤æ  -->
  <view class="quick-commands">
    <scroll-view class="commands-scroll" scroll-x show-scrollbar="{{false}}">
      <view class="command-chip" wx:for="{{quickCommands}}" wx:key="text" bindtap="useQuickCommand" data-command="{{item.text}}">
        <text class="chip-icon">{{item.icon}}</text>
        <text class="chip-text">{{item.text}}</text>
      </view>
    </scroll-view>
  </view>

  <!-- è¾“å…¥åŒºåŸŸ -->
  <view class="input-area">
    <view class="input-wrapper">
      <input
        class="message-input"
        type="text"
        placeholder="è¾“å…¥æŒ‡ä»¤ï¼Œå¦‚ï¼šä¹°å…¥ 0.01 ä¸ª ETH..."
        placeholder-class="input-placeholder"
        value="{{inputText}}"
        bindinput="onInputChange"
        bindconfirm="sendMessage"
        disabled="{{isProcessing}}"
      />
      <button
        class="send-btn {{inputText && !isProcessing ? 'active' : ''}}"
        bindtap="sendMessage"
        disabled="{{!inputText || isProcessing}}"
      >
        <text class="send-icon">{{isProcessing ? 'â³' : 'â¤'}}</text>
      </button>
    </view>
  </view>
</view>
