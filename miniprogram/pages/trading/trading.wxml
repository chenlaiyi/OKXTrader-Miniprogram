<!--pages/trading/trading.wxml-->
<view class="container">
  <!-- ä»·æ ¼ä¿¡æ¯å¤´éƒ¨ -->
  <view class="price-header">
    <view class="symbol-info">
      <view class="symbol">{{currentSymbol}}</view>
      <view class="symbol-name">{{symbolName || 'BTC/USDT'}}</view>
    </view>
    <view class="price-info">
      <view class="price {{priceTrend}}">{{currentPrice}}</view>
      <view class="price-change {{priceTrend}}">
        <text class="change-icon">{{priceTrend === 'up' ? 'â–²' : priceTrend === 'down' ? 'â–¼' : 'âˆ’'}}</text>
        <text class="change-value">{{priceChange}}</text>
        <text class="change-percent">({{priceChangePercent}}%)</text>
      </view>
    </view>
  </view>

  <!-- 24hç»Ÿè®¡ -->
  <view class="stats-bar">
    <view class="stat-item">
      <text class="stat-label">24hé«˜</text>
      <text class="stat-value">{{high24h}}</text>
    </view>
    <view class="stat-item">
      <text class="stat-label">24hä½</text>
      <text class="stat-value">{{low24h}}</text>
    </view>
    <view class="stat-item">
      <text class="stat-label">24hé‡</text>
      <text class="stat-value">{{volume24h}}</text>
    </view>
  </view>

  <!-- Kçº¿å›¾åŒºåŸŸ -->
  <view class="chart-section">
    <view class="chart-header">
      <view class="chart-title">Kçº¿å›¾</view>
      <view class="timeframe-selector">
        <view class="timeframe-item {{timeframe === '15m' ? 'active' : ''}}" bindtap="switchTimeframe" data-tf="15m">15m</view>
        <view class="timeframe-item {{timeframe === '1H' ? 'active' : ''}}" bindtap="switchTimeframe" data-tf="1H">1H</view>
        <view class="timeframe-item {{timeframe === '4H' ? 'active' : ''}}" bindtap="switchTimeframe" data-tf="4H">4H</view>
        <view class="timeframe-item {{timeframe === '1D' ? 'active' : ''}}" bindtap="switchTimeframe" data-tf="1D">1D</view>
      </view>
    </view>
    <view class="chart-container">
      <view class="chart-placeholder">
        <view class="placeholder-icon">ğŸ“Š</view>
        <view class="placeholder-text">Kçº¿å›¾è¡¨</view>
        <view class="placeholder-hint">ï¼ˆéœ€é›†æˆ echarts-for-weixinï¼‰</view>
      </view>
    </view>
  </view>

  <!-- äº¤æ˜“æ“ä½œåŒº -->
  <view class="trade-section">
    <view class="trade-header">
      <view class="trade-title">å¿«é€Ÿäº¤æ˜“</view>
      <view class="trade-hint">AIç­–ç•¥å»ºè®®ï¼š{{aiSuggestion || 'æš‚æ— å»ºè®®'}}</view>
    </view>

    <!-- äº¤æ˜“ç±»å‹é€‰æ‹© -->
    <view class="trade-type-selector">
      <view class="trade-type-item {{tradeType === 'market' ? 'active' : ''}}" bindtap="switchTradeType" data-type="market">
        <text class="type-text">å¸‚ä»·å•</text>
      </view>
      <view class="trade-type-item {{tradeType === 'limit' ? 'active' : ''}}" bindtap="switchTradeType" data-type="limit">
        <text class="type-text">é™ä»·å•</text>
      </view>
    </view>

    <!-- é™ä»·å•ä»·æ ¼è¾“å…¥ï¼ˆä»…é™ä»·å•æ˜¾ç¤ºï¼‰ -->
    <view class="price-input-wrapper" wx:if="{{tradeType === 'limit'}}">
      <text class="input-label">å§”æ‰˜ä»·æ ¼</text>
      <input class="price-input" type="digit" placeholder="è¾“å…¥ä»·æ ¼" value="{{limitPrice}}" bindinput="onLimitPriceInput"/>
    </view>

    <!-- æ•°é‡è¾“å…¥ -->
    <view class="amount-input-wrapper">
      <view class="amount-header">
        <text class="input-label">äº¤æ˜“æ•°é‡</text>
        <text class="amount-hint">å¯ç”¨: {{availableBalance}} USDT</text>
      </view>
      <view class="amount-input-row">
        <input class="amount-input" type="digit" placeholder="è¾“å…¥æ•°é‡" value="{{tradeAmount}}" bindinput="onAmountInput"/>
        <text class="amount-suffix">USDT</text>
      </view>
      <view class="amount-presets">
        <view class="preset-item" bindtap="setAmountPercent" data-percent="25">25%</view>
        <view class="preset-item" bindtap="setAmountPercent" data-percent="50">50%</view>
        <view class="preset-item" bindtap="setAmountPercent" data-percent="75">75%</view>
        <view class="preset-item" bindtap="setAmountPercent" data-percent="100">100%</view>
      </view>
    </view>

    <!-- äº¤æ˜“æŒ‰é’® -->
    <view class="trade-buttons">
      <button class="trade-btn buy-btn" bindtap="executeTrade" data-side="long">
        <view class="btn-icon">ğŸ“ˆ</view>
        <view class="btn-content">
          <text class="btn-text">ä¹°å…¥åšå¤š</text>
          <text class="btn-hint">{{currentPrice}}</text>
        </view>
      </button>
      <button class="trade-btn sell-btn" bindtap="executeTrade" data-side="short">
        <view class="btn-icon">ğŸ“‰</view>
        <view class="btn-content">
          <text class="btn-text">å–å‡ºåšç©º</text>
          <text class="btn-hint">{{currentPrice}}</text>
        </view>
      </button>
    </view>
  </view>

  <!-- å½“å‰æŒä»“ -->
  <view class="positions-section">
    <view class="section-header">
      <view class="section-icon">ğŸ’¼</view>
      <view class="section-title">å½“å‰æŒä»“</view>
      <view class="position-count">{{positions.length}}</view>
    </view>

    <view wx:if="{{positions.length === 0}}" class="empty-state">
      <view class="empty-icon">ğŸ“­</view>
      <view class="empty-text">æš‚æ— æŒä»“</view>
      <view class="empty-hint">å¼€ä»“åæŒä»“å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</view>
    </view>

    <view class="position-list">
      <view class="position-item" wx:for="{{positions}}" wx:key="id" bindtap="showPositionDetail" data-id="{{item.id}}">
        <view class="pos-header">
          <view class="pos-symbol">{{item.symbol}}</view>
          <view class="pos-side {{item.side}}">
            <text class="side-icon">{{item.side === 'long' ? 'ğŸ“ˆ' : 'ğŸ“‰'}}</text>
            <text class="side-text">{{item.side === 'long' ? 'åšå¤š' : 'åšç©º'}}</text>
          </view>
        </view>

        <view class="pos-body">
          <view class="pos-row">
            <view class="pos-info-group">
              <text class="pos-label">å…¥åœºä»·</text>
              <text class="pos-value">{{item.entryPrice}}</text>
            </view>
            <view class="pos-info-group">
              <text class="pos-label">å½“å‰ä»·</text>
              <text class="pos-value">{{item.currentPrice || '--'}}</text>
            </view>
          </view>

          <view class="pos-divider"></view>

          <view class="pos-row">
            <view class="pos-info-group">
              <text class="pos-label">æ•°é‡</text>
              <text class="pos-value">{{item.quantity}}</text>
            </view>
            <view class="pos-info-group">
              <text class="pos-label">æœªå®ç°ç›ˆäº</text>
              <text class="pos-value {{item.pnlClass}}">{{item.pnlDisplay}}</text>
            </view>
          </view>
        </view>

        <view class="pos-footer">
          <view class="pos-time">å…¥åœºæ—¶é—´: {{item.entryTime}}</view>
          <view class="pos-actions">
            <button class="pos-action-btn close-btn" catchtap="closePosition" data-id="{{item.id}}">å¹³ä»“</button>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- äº¤æ˜“è®°å½• -->
  <view class="history-section">
    <view class="section-header">
      <view class="section-icon">ğŸ“œ</view>
      <view class="section-title">æœ€è¿‘æˆäº¤</view>
      <view class="section-more" bindtap="goToHistory">æ›´å¤š â†’</view>
    </view>

    <view wx:if="{{recentTrades.length === 0}}" class="empty-state">
      <view class="empty-text">æš‚æ— æˆäº¤è®°å½•</view>
    </view>

    <view class="trade-list">
      <view class="trade-item" wx:for="{{recentTrades}}" wx:key="id">
        <view class="trade-left">
          <view class="trade-symbol">{{item.symbol}}</view>
          <view class="trade-time">{{item.time}}</view>
        </view>
        <view class="trade-right">
          <view class="trade-side {{item.side}}">{{item.side === 'long' ? 'åšå¤š' : 'åšç©º'}}</view>
          <view class="trade-pnl {{item.profit ? 'profit' : 'loss'}}">{{item.pnl}}</view>
        </view>
      </view>
    </view>
  </view>
</view>
