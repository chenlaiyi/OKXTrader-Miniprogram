<!--pages/trading/trading.wxml-->
<view class="container">
  <!-- å‡€ç›ˆäºç»Ÿè®¡å¡ç‰‡ (iOSé£æ ¼) -->
  <view class="pnl-stats-card">
    <!-- ä»Šæ—¥/æ˜¨æ—¥ ä¸»è¦æ•°æ® -->
    <view class="pnl-main-row">
      <view class="pnl-main-item">
        <view class="main-label-row">
          <text class="main-label">ä»Šæ—¥</text>
          <text class="main-count">({{todayTradeCount}}ç¬”)</text>
        </view>
        <text class="main-value {{todayPnl >= 0 ? 'green' : 'red'}}">{{todayPnlDisplay}}</text>
      </view>
      <view class="pnl-main-divider"></view>
      <view class="pnl-main-item">
        <view class="main-label-row">
          <text class="main-label">æ˜¨æ—¥</text>
          <text class="main-count">({{yesterdayTradeCount}}ç¬”)</text>
        </view>
        <text class="main-value {{yesterdayPnl >= 0 ? 'green' : 'red'}}">{{yesterdayPnlDisplay}}</text>
      </view>
    </view>

    <view class="pnl-divider"></view>

    <!-- æ€»è®¡/æœ¬å‘¨ æ¬¡è¦æ•°æ® -->
    <view class="pnl-secondary-row">
      <view class="pnl-secondary-item">
        <text class="secondary-label">æ€»è®¡ ({{totalTradeCount}}ç¬”)</text>
        <text class="secondary-value {{totalPnl >= 0 ? 'green' : 'red'}}">{{totalPnlDisplay}}</text>
      </view>
      <view class="pnl-secondary-item">
        <text class="secondary-label">æœ¬å‘¨ ({{weekTradeCount}}ç¬”)</text>
        <text class="secondary-value {{weekPnl >= 0 ? 'green' : 'red'}}">{{weekPnlDisplay}}</text>
      </view>
    </view>
  </view>

  <!-- Tabåˆ‡æ¢ (iOSé£æ ¼åˆ†æ®µé€‰æ‹©å™¨) -->
  <view class="tab-switcher">
    <view class="tab-item {{selectedTab === 0 ? 'active' : ''}}" bindtap="switchTab" data-tab="0">
      <text class="tab-text">æˆäº¤è®°å½•</text>
    </view>
    <view class="tab-item {{selectedTab === 1 ? 'active' : ''}}" bindtap="switchTab" data-tab="1">
      <text class="tab-text">å½“å‰æŒä»“</text>
    </view>
  </view>

  <!-- è‡ªåŠ¨åˆ·æ–°çŠ¶æ€æç¤º -->
  <view class="auto-refresh-status">
    <text class="refresh-icon">ğŸ”„</text>
    <text class="refresh-text">è‡ªåŠ¨åˆ·æ–°ä¸­</text>
    <text class="refresh-interval">(10ç§’)</text>
  </view>

  <!-- å†…å®¹åŒºåŸŸ -->
  <scroll-view class="content-scroll" scroll-y refresher-enabled refresher-triggered="{{refreshing}}" bindrefresherrefresh="onRefresh">
    <!-- æˆäº¤è®°å½•åˆ—è¡¨ -->
    <view class="trade-list" wx:if="{{selectedTab === 0}}">
      <view wx:if="{{fillHistory.length === 0}}" class="empty-state">
        <text class="empty-icon">ğŸ“‹</text>
        <text class="empty-text">æš‚æ— æˆäº¤è®°å½•</text>
      </view>
      <view class="trade-item" wx:for="{{fillHistory}}" wx:key="id">
        <view class="trade-left">
          <view class="trade-header">
            <text class="trade-symbol">{{item.symbol}}</text>
            <view class="trade-tag {{item.operationClass}}">
              <text class="tag-text">{{item.operationLabel}}</text>
            </view>
            <view class="trade-source-tag {{item.sourceClass}}">
              <text class="source-text">{{item.source}}</text>
            </view>
            <text class="trade-leverage" wx:if="{{item.leverage}}">{{item.leverage}}x</text>
          </view>
          <view class="trade-info-row">
            <text class="trade-time">{{item.time}}</text>
            <text class="trade-price">@{{item.priceDisplay}}</text>
          </view>
          <text class="trade-reason" wx:if="{{item.exitReason}}">{{item.exitReason}}</text>
        </view>
        <view class="trade-right">
          <text class="trade-pnl {{item.pnl >= 0 ? 'profit' : 'loss'}}" wx:if="{{item.pnl !== 0}}">
            {{item.pnl >= 0 ? '+' : ''}}{{item.pnlDisplay}}
          </text>
          <text class="trade-size" wx:else>{{item.sizeDisplay}}</text>
          <text class="trade-fee">è´¹:{{item.feeDisplay}}</text>
        </view>
      </view>
    </view>

    <!-- å½“å‰æŒä»“åˆ—è¡¨ -->
    <view class="position-list" wx:if="{{selectedTab === 1}}">
      <view wx:if="{{positions.length === 0}}" class="empty-state">
        <text class="empty-icon">ğŸ“Š</text>
        <text class="empty-text">æš‚æ— æŒä»“</text>
      </view>
      <view class="position-item" wx:for="{{positions}}" wx:key="posId">
        <view class="position-left">
          <view class="position-header">
            <text class="position-symbol">{{item.instId}}</text>
            <view class="position-direction {{item.posSide === 'long' ? 'long' : 'short'}}">
              <text class="direction-text">{{item.posSide === 'long' ? 'å¤š' : 'ç©º'}}</text>
            </view>
            <text class="position-leverage">{{item.lever}}x</text>
          </view>
          <view class="position-details">
            <text class="position-detail">æ•°é‡: {{item.pos}}</text>
            <text class="position-detail">å‡ä»·: {{item.avgPx}}</text>
          </view>
        </view>
        <view class="position-right">
          <view class="pnl-label">å‡€ç›ˆäº</view>
          <text class="position-pnl {{item.uplNum >= 0 ? 'profit' : 'loss'}}">
            {{item.uplNum >= 0 ? '+' : ''}}{{item.uplDisplay}} USDT
          </text>
          <view class="pnl-ratio-badge {{item.uplNum >= 0 ? 'profit-bg' : 'loss-bg'}}">
            <text class="pnl-ratio-text">{{item.uplNum >= 0 ? '+' : ''}}{{item.uplRatioDisplay}}%</text>
          </view>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- åˆ·æ–°æŒ‰é’® -->
  <view class="refresh-footer">
    <button class="refresh-btn" bindtap="onRefresh" loading="{{refreshing}}">
      <text class="refresh-icon" wx:if="{{!refreshing}}">â†»</text>
      <text class="refresh-text">{{refreshing ? 'åˆ·æ–°ä¸­...' : 'åˆ·æ–°æ•°æ®'}}</text>
    </button>
  </view>
</view>
