<!--pages/account/account.wxml-->
<view class="container">
  <!-- ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-card">
    <view class="stat-item">
      <text class="stat-value">{{accountStats.total}}</text>
      <text class="stat-label">æ€»è´¦å·</text>
    </view>
    <view class="stat-item">
      <text class="stat-value">{{accountStats.real}}</text>
      <text class="stat-label">çœŸå®è´¦å·</text>
    </view>
    <view class="stat-item">
      <text class="stat-value">{{accountStats.simulated}}</text>
      <text class="stat-label">æ¨¡æ‹Ÿè´¦å·</text>
    </view>
    <view class="stat-item">
      <text class="stat-value">{{accountStats.validated}}</text>
      <text class="stat-label">å·²éªŒè¯</text>
    </view>
  </view>

  <!-- è´¦å·åˆ—è¡¨ -->
  <view class="account-list">
    <view class="section-title">æˆ‘çš„è´¦å·</view>

    <view class="account-item {{index === currentAccountIndex ? 'active' : ''}}"
          wx:for="{{accounts}}"
          wx:key="id"
          bindtap="switchAccount"
          data-index="{{index}}">
      <view class="account-header">
        <view class="account-info">
          <view class="account-name">
            <text wx:if="{{item.isSimulation}}">ğŸ¯</text>
            {{item.name}}
            <text class="badge {{item.is_default ? 'default' : ''}}" wx:if="{{item.is_default}}">
              é»˜è®¤
            </text>
          </view>
          <view class="account-id">{{item.id}}</view>
        </view>
        <view class="account-status">
          <view class="status-dot {{index === currentAccountIndex ? 'active' : ''}}"></view>
          <text class="status-text">{{index === currentAccountIndex ? 'å½“å‰è´¦å·' : ''}}</text>
        </view>
      </view>

      <view class="account-details">
        <view class="detail-item">
          <text class="detail-label">API Key</text>
          <text class="detail-value">{{item.apiKey ? item.apiKey.substring(0, 8) + '...' : 'æ— '}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">éªŒè¯çŠ¶æ€</text>
          <text class="detail-value {{item.is_validated ? 'valid' : 'invalid'}}">
            {{item.is_validated ? 'å·²éªŒè¯' : 'æœªéªŒè¯'}}
          </text>
        </view>
        <view class="detail-item">
          <text class="detail-label">ç±»å‹</text>
          <text class="detail-value {{item.isSimulation ? 'simulation' : 'real'}}">
            {{item.isSimulation ? 'æ¨¡æ‹Ÿè´¦å·' : 'çœŸå®è´¦å·'}}
          </text>
        </view>
      </view>

      <view class="account-actions">
        <button class="action-btn" size="mini" bindtap="setDefaultAccount" data-index="{{index}}" wx:if="{{!item.is_default}}">
          è®¾ä¸ºé»˜è®¤
        </button>
        <button class="action-btn" size="mini" bindtap="validateAccount" data-index="{{index}}" wx:if="{{!item.isSimulation && !item.is_validated}}">
          éªŒè¯
        </button>
        <button class="action-btn" size="mini" bindtap="showEditModal" data-index="{{index}}">
          ç¼–è¾‘
        </button>
        <button class="action-btn danger" size="mini" bindtap="deleteAccount" data-index="{{index}}" wx:if="{{accounts.length > 1}}">
          åˆ é™¤
        </button>
      </view>
    </view>

    <view class="empty-state" wx:if="{{accounts.length === 0}}">
      <text class="empty-text">æš‚æ— è´¦å·</text>
    </view>
  </view>

  <!-- æ·»åŠ æŒ‰é’® -->
  <view class="add-button">
    <button class="btn-primary" bindtap="showAddModal">+ æ·»åŠ è´¦å·</button>
  </view>

  <!-- åŠŸèƒ½å…¥å£ -->
  <view class="features">
    <button class="feature-btn" bindtap="goToMonitor">
      <text class="feature-icon">ğŸ¯</text>
      <text class="feature-text">äº¤æ˜“ç›‘æ§</text>
    </button>
    <button class="feature-btn" bindtap="goToStrategy">
      <text class="feature-icon">âš™ï¸</text>
      <text class="feature-text">ç­–ç•¥ç®¡ç†</text>
    </button>
  </view>
</view>

<!-- æ¨¡æ€æ¡† -->
<view class="modal-mask" wx:if="{{showModal}}" bindtap="closeModal">
  <view class="modal-content" catchtap="">
    <view class="modal-header">
      <text class="modal-title">{{modalMode === 'add' ? 'æ·»åŠ è´¦å·' : 'ç¼–è¾‘è´¦å·'}}</text>
      <text class="modal-close" bindtap="closeModal">âœ•</text>
    </view>

    <view class="modal-body">
      <view class="form-item">
        <text class="form-label">è´¦å·åç§° *</text>
        <input class="form-input"
               placeholder="è¯·è¾“å…¥è´¦å·åç§°"
               value="{{formData.name}}"
               bindinput="onInputChange"
               data-field="name"/>
      </view>

      <view class="form-item">
        <view class="form-row">
          <view class="form-row-left">
            <text class="form-label">æ¨¡æ‹Ÿè´¦å·</text>
            <switch checked="{{formData.isSimulation}}"
                    bindchange="onSimulationChange"
                    color="#667eea"/>
          </view>
          <text class="form-hint">æ¨¡æ‹Ÿè´¦å·æ— éœ€APIå¯†é’¥</text>
        </view>
      </view>

      <view class="form-group" wx:if="{{!formData.isSimulation}}">
        <text class="form-group-title">APIé…ç½®</text>

        <view class="form-item">
          <text class="form-label">API Key *</text>
          <input class="form-input"
                 placeholder="è¯·è¾“å…¥API Key"
                 value="{{formData.apiKey}}"
                 bindinput="onInputChange"
                 data-field="apiKey"/>
        </view>

        <view class="form-item">
          <text class="form-label">Secret Key *</text>
          <input class="form-input"
                 placeholder="è¯·è¾“å…¥Secret Key"
                 value="{{formData.secretKey}}"
                 bindinput="onInputChange"
                 data-field="secretKey"/>
        </view>

        <view class="form-item">
          <text class="form-label">Passphrase *</text>
          <input class="form-input"
                 placeholder="è¯·è¾“å…¥Passphrase"
                 value="{{formData.passphrase}}"
                 bindinput="onInputChange"
                 data-field="passphrase"/>
        </view>
      </view>
    </view>

    <view class="modal-footer">
      <button class="modal-btn cancel" bindtap="closeModal">å–æ¶ˆ</button>
      <button class="modal-btn confirm" bindtap="saveAccount">ä¿å­˜</button>
    </view>
  </view>
</view>
