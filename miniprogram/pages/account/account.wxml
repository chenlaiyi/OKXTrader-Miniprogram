<!--pages/account/account.wxml-->
<view class="container">
  <!-- æœªç™»å½•æç¤º -->
  <view class="login-prompt" wx:if="{{!userInfo}}">
    <text class="prompt-icon">ğŸ‘‹</text>
    <text class="prompt-title">æ¬¢è¿ä½¿ç”¨OKXTrader</text>
    <text class="prompt-desc">è¯·å…ˆç™»å½•ä»¥ä½¿ç”¨å®Œæ•´åŠŸèƒ½</text>
    <button class="login-btn" bindtap="goToLogin">
      å¾®ä¿¡æˆæƒç™»å½•
    </button>
  </view>

  <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
  <view class="account-hero" wx:if="{{userInfo}}">
    <view class="hero-header">
      <image class="avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
      <view class="hero-main">
        <text class="nickname">{{userInfo.nickname}}</text>
        <view class="account-line">
          <text class="account-name">{{currentAccount.name || 'æœªé€‰æ‹©'}}</text>
        </view>
        <text class="meta-text">ç”¨æˆ·ID: {{userInfo.userIdDisplay || userInfo.dbUserId || '--'}}</text>
      </view>
      <button class="icon-btn" bindtap="goToAccountList">
        <text class="icon-btn-text">ç®¡ç†</text>
      </button>
    </view>
    <view class="equity-block">
      <text class="equity-label">è´¦æˆ·æ€»èµ„äº§</text>
      <view class="equity-row">
        <text class="equity-value">{{accountInfo.totalEquity || '0.00'}}</text>
        <text class="equity-unit">USDT</text>
      </view>
    </view>
    <view class="stats-row">
      <view class="stat-item">
        <text class="stat-label">è´¦å·æ•°</text>
        <text class="stat-value">{{accountCount}}</text>
      </view>
      <view class="stat-item">
        <text class="stat-label">èµ„äº§å¸ç§</text>
        <text class="stat-value">{{balances.length}}</text>
      </view>
      <view class="stat-item">
        <text class="stat-label">è´¦å·çŠ¶æ€</text>
        <text class="stat-value">{{currentAccount.name ? 'å·²ç»‘å®š' : '--'}}</text>
      </view>
    </view>
    <view class="hero-actions">
      <button class="primary-btn" bindtap="showAccountActionSheet">åˆ‡æ¢è´¦å·</button>
      <button class="ghost-btn" bindtap="goToAddAccount">æ·»åŠ è´¦å·</button>
      <button class="ghost-btn logout-btn" bindtap="handleLogout">é€€å‡º</button>
    </view>
  </view>

  <scroll-view class="content-scroll" scroll-y wx:if="{{userInfo}}">

    <!-- èµ„äº§æ˜ç»†å¡ç‰‡ (iOSé£æ ¼) -->
    <view class="section-card">
      <view class="section-header">
        <text class="section-title">ğŸ’° èµ„äº§æ˜ç»†</text>
        <button class="refresh-mini-btn" bindtap="refreshAssets">
          <text class="refresh-icon">â†»</text>
        </button>
      </view>
      <view wx:if="{{balances.length === 0}}" class="empty-row">
        <text class="empty-text">æš‚æ— èµ„äº§</text>
      </view>
      <view wx:else class="balance-list">
        <view class="balance-item" wx:for="{{balances}}" wx:key="currency">
          <view class="balance-left">
            <view class="currency-icon">
              <text class="currency-letter">{{item.currency[0]}}</text>
            </view>
            <text class="currency-name">{{item.currency}}</text>
          </view>
          <view class="balance-right">
            <text class="balance-amount">{{item.totalDisplay}}</text>
            <text class="balance-usd">â‰ˆ ${{item.usdValueDisplay}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- åŠŸèƒ½å…¥å£ -->
    <view class="features-grid">
      <button class="feature-btn" bindtap="goToMonitor">
        <text class="feature-icon">ğŸ¯</text>
        <text class="feature-text">äº¤æ˜“ç›‘æ§</text>
      </button>
      <button class="feature-btn" bindtap="goToStrategy">
        <text class="feature-icon">âš™ï¸</text>
        <text class="feature-text">ç­–ç•¥ç®¡ç†</text>
      </button>
    </view>

    <!-- åˆ·æ–°æŒ‰é’® -->
    <view class="refresh-section">
      <button class="refresh-all-btn" bindtap="refreshAll" loading="{{isRefreshing}}">
        <text class="btn-icon" wx:if="{{!isRefreshing}}">â†»</text>
        <text class="btn-text">{{isRefreshing ? 'åˆ·æ–°ä¸­...' : 'åˆ·æ–°è´¦æˆ·ä¿¡æ¯'}}</text>
      </button>
    </view>
  </scroll-view>
</view>
