<!--pages/ai/ai.wxml-->
<view class="container">
  <!-- ç­–ç•¥çŠ¶æ€æ  (iOSé£æ ¼) -->
  <view class="strategy-status-bar">
    <view class="strategy-left">
      <text class="strategy-emoji">{{currentStrategy.emoji}}</text>
      <view class="strategy-info">
        <text class="strategy-label">å½“å‰ç­–ç•¥</text>
        <text class="strategy-name">{{currentStrategy.name}}</text>
      </view>
    </view>
    <view class="strategy-right">
      <view class="style-badge {{tradingStyle === 'aggressive' ? 'aggressive' : 'conservative'}}">
        <text class="style-icon">{{tradingStyle === 'aggressive' ? 'ğŸ”¥' : 'ğŸ›¡ï¸'}}</text>
        <text class="style-text">{{tradingStyle === 'aggressive' ? 'æ¿€è¿›' : 'ç¨³å¥'}}</text>
      </view>
    </view>
  </view>

  <!-- æ ¸å¿ƒå‚æ•°å¡ç‰‡ (iOSé£æ ¼) -->
  <view class="core-params-card">
    <text class="params-title">ğŸ“Š æ ¸å¿ƒå‚æ•°</text>
    <view class="params-grid">
      <view class="param-item green">
        <text class="param-icon">â†‘</text>
        <view class="param-content">
          <text class="param-label">æ­¢ç›ˆ</text>
          <text class="param-value">{{takeProfitPercent}}%</text>
        </view>
      </view>
      <view class="param-item red">
        <text class="param-icon">â†“</text>
        <view class="param-content">
          <text class="param-label">æ­¢æŸ</text>
          <text class="param-value">{{stopLossPercent}}%</text>
        </view>
      </view>
      <view class="param-item orange">
        <text class="param-icon">ğŸ“Š</text>
        <view class="param-content">
          <text class="param-label">æ æ†</text>
          <text class="param-value">{{leverage}}x</text>
        </view>
      </view>
      <view class="param-item purple">
        <text class="param-icon">âœ“</text>
        <view class="param-content">
          <text class="param-label">ç½®ä¿¡åº¦</text>
          <text class="param-value">{{confidenceThreshold}}%</text>
        </view>
      </view>
    </view>
    <view class="params-row">
      <text class="row-icon">ğŸ•</text>
      <text class="row-label">åˆ†æé—´éš”</text>
      <text class="row-value">{{analysisInterval}}åˆ†é’Ÿ</text>
    </view>
  </view>

  <!-- è‡ªåŠ¨äº¤æ˜“å¼€å…³ -->
  <view class="auto-trade-card">
    <view class="auto-trade-info">
      <text class="auto-icon">âš¡</text>
      <text class="auto-label">è‡ªåŠ¨äº¤æ˜“</text>
    </view>
    <switch
      checked="{{autoTradeEnabled}}"
      bindchange="toggleAutoTrade"
      color="#af52de"
    />
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons">
    <button
      class="action-btn primary"
      bindtap="startAnalysis"
      disabled="{{isAnalyzing}}"
    >
      <text class="btn-icon" wx:if="{{!isAnalyzing}}">âœ¨</text>
      <text class="btn-text">{{isAnalyzing ? 'åˆ†æä¸­...' : 'AIåˆ†æ'}}</text>
    </button>
    <button
      class="action-btn {{autoAnalysisEnabled ? 'danger' : 'success'}}"
      bindtap="toggleAutoAnalysis"
    >
      <text class="btn-icon">{{autoAnalysisEnabled ? 'â¹' : 'â–¶ï¸'}}</text>
      <text class="btn-text">{{autoAnalysisEnabled ? 'åœæ­¢' : 'è‡ªåŠ¨'}}</text>
    </button>
  </view>

  <!-- æ»šåŠ¨å†…å®¹åŒº -->
  <scroll-view class="content-scroll" scroll-y>
    <!-- å½“å‰åˆ†æç»“æœ (åŒä¿¡å·æ˜¾ç¤º - iOSé£æ ¼) -->
    <view class="analysis-result" wx:if="{{currentAnalysis}}">
      <view class="analysis-header">
        <text class="analysis-title">ğŸ“Š æœ€æ–°åˆ†æ</text>
        <text class="analysis-time">{{analysisTime}}</text>
      </view>
      
      <!-- åŒä¿¡å·æ˜¾ç¤º -->
      <view class="dual-signal-section">
        <view class="signal-card">
          <text class="signal-label">ç°è´§ä¿¡å·</text>
          <text class="signal-value {{currentAnalysis.spotSignalClass}}">{{currentAnalysis.spotSignalText}}</text>
        </view>
        <view class="signal-divider"></view>
        <view class="signal-card">
          <text class="signal-label">åˆçº¦ä¿¡å·</text>
          <text class="signal-value {{currentAnalysis.contractSignalClass}}">{{currentAnalysis.contractSignalText}}</text>
        </view>
      </view>
      
      <!-- ç½®ä¿¡åº¦ -->
      <view class="confidence-row">
        <text class="confidence-label">ç½®ä¿¡åº¦</text>
        <text class="confidence-value {{currentAnalysis.confidence >= 70 ? 'high' : 'medium'}}">{{currentAnalysis.confidence}}%</text>
      </view>
      
      <view class="divider"></view>
      
      <!-- ä»·æ ¼å»ºè®® -->
      <view class="price-suggestions" wx:if="{{currentAnalysis.suggestedPrice || currentAnalysis.stopLoss || currentAnalysis.takeProfit}}">
        <view class="price-item" wx:if="{{currentAnalysis.suggestedPrice}}">
          <text class="price-label">å…¥åœºä»·</text>
          <text class="price-value blue">${{currentAnalysis.suggestedPrice}}</text>
        </view>
        <view class="price-item" wx:if="{{currentAnalysis.stopLoss}}">
          <text class="price-label">æ­¢æŸ</text>
          <text class="price-value red">${{currentAnalysis.stopLoss}}</text>
        </view>
        <view class="price-item" wx:if="{{currentAnalysis.takeProfit}}">
          <text class="price-label">æ­¢ç›ˆ</text>
          <text class="price-value green">${{currentAnalysis.takeProfit}}</text>
        </view>
      </view>
      
      <view class="divider" wx:if="{{currentAnalysis.suggestedPrice}}"></view>
      
      <!-- åˆ†æç†ç”± -->
      <view class="reasoning-section">
        <text class="reasoning-title">åˆ†æç†ç”±</text>
        <text class="reasoning-text">{{currentAnalysis.reasoning}}</text>
      </view>
      
      <!-- é£é™©æç¤º -->
      <view class="risks-section" wx:if="{{currentAnalysis.risks.length > 0}}">
        <view class="divider"></view>
        <text class="risks-title">âš ï¸ é£é™©æç¤º</text>
        <view class="risks-list">
          <view class="risk-item" wx:for="{{currentAnalysis.risks}}" wx:key="index">
            <text class="risk-dot">â€¢</text>
            <text class="risk-text">{{item}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{!currentAnalysis}}">
      <text class="empty-icon">ğŸ“Š</text>
      <text class="empty-text">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹ AI åˆ†æ</text>
    </view>

    <!-- æŒä»“åŒºåŸŸ -->
    <view class="positions-section" wx:if="{{apiPositions.length > 0}}">
      <view class="section-header">
        <text class="section-title">ğŸ“ å½“å‰æŒä»“</text>
        <button class="mini-btn" bindtap="refreshPositions">
          <text class="mini-icon">â†»</text>
        </button>
      </view>
      <view class="position-list">
        <view class="position-item" wx:for="{{apiPositions}}" wx:key="instId">
          <view class="position-direction {{item.side}}">
            <text class="direction-icon">{{item.side === 'long' ? 'ğŸ“ˆ' : 'ğŸ“‰'}}</text>
            <text class="direction-text">{{item.side === 'long' ? 'å¤š' : 'ç©º'}}</text>
          </view>
          <view class="position-info">
            <view class="position-header">
              <text class="position-symbol">{{item.instId}}</text>
              <text class="position-leverage">{{item.leverage}}x</text>
            </view>
            <view class="position-details">
              <text class="position-detail">æ•°é‡: {{item.quantity}}</text>
              <text class="position-detail">å‡ä»·: {{item.avgPrice}}</text>
            </view>
          </view>
          <view class="position-pnl {{item.pnl >= 0 ? 'profit' : 'loss'}}">
            <text class="pnl-amount">{{item.pnl >= 0 ? '+' : ''}}{{item.pnl}}</text>
            <text class="pnl-percent">({{item.pnlPercent}})</text>
          </view>
        </view>
      </view>
    </view>

    <!-- åˆ†æå†å² -->
    <view class="history-section">
      <view class="history-header">
        <text class="history-title">ğŸ“œ åˆ†æå†å²</text>
        <text class="history-count">å…±{{historyList.length}}æ¡</text>
      </view>
      <view class="history-stats-bar" wx:if="{{historyList.length > 0}}">
        <view class="stat-item">
          <text class="stat-dot green"></text>
          <text class="stat-text">ä¹°{{buyCount}}</text>
        </view>
        <view class="stat-item">
          <text class="stat-dot red"></text>
          <text class="stat-text">å–{{sellCount}}</text>
        </view>
        <view class="stat-item">
          <text class="stat-dot yellow"></text>
          <text class="stat-text">è§‚æœ›{{holdCount}}</text>
        </view>
      </view>
      <view class="history-list">
        <view class="history-item" wx:for="{{historyList}}" wx:key="id" bindtap="viewHistoryDetail" data-item="{{item}}">
          <text class="history-time">{{item.time}}</text>
          <text class="history-symbol">{{item.symbol}}</text>
          <text class="history-signal {{item.signalClass}}">{{item.signalText}}</text>
          <text class="history-confidence">{{item.confidence}}%</text>
          <text class="history-arrow">â€º</text>
        </view>
      </view>
    </view>
  </scroll-view>
</view>
