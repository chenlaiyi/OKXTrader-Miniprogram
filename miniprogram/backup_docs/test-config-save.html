<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç­–ç•¥é…ç½®ä¿å­˜æµ‹è¯•</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
      background: #f5f5f7;
    }
    .card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 { color: #1d1d1f; margin-bottom: 20px; }
    h2 { color: #1d1d1f; margin-top: 0; }
    .button {
      background: #007aff;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      margin-right: 10px;
      margin-bottom: 10px;
    }
    .button:hover { background: #0051d5; }
    .button.secondary { background: #8e8e93; }
    .button.secondary:hover { background: #636366; }
    .log {
      background: #1e1e1e;
      color: #00ff00;
      padding: 15px;
      border-radius: 8px;
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 13px;
      max-height: 400px;
      overflow-y: auto;
      white-space: pre-wrap;
    }
    .status {
      padding: 8px 12px;
      border-radius: 6px;
      margin-bottom: 10px;
      font-weight: 500;
    }
    .status.success { background: #d4edda; color: #155724; }
    .status.error { background: #f8d7da; color: #721c24; }
    .status.info { background: #d1ecf1; color: #0c5460; }
    .input-group {
      margin-bottom: 15px;
    }
    label {
      display: block;
      margin-bottom: 5px;
      color: #1d1d1f;
      font-weight: 500;
    }
    select, input {
      width: 100%;
      padding: 10px;
      border: 1px solid #d1d1d6;
      border-radius: 8px;
      font-size: 16px;
    }
    .emoji { font-size: 20px; }
  </style>
</head>
<body>
  <h1>ğŸ§ª ç­–ç•¥é…ç½®ä¿å­˜æµ‹è¯•</h1>

  <div class="card">
    <h2>ğŸ“ æµ‹è¯•é…ç½®</h2>
    <div class="input-group">
      <label>äº¤æ˜“æ¨¡å¼ (tradingMode):</label>
      <select id="tradingMode">
        <option value="ai">ğŸ¤– AIè¾…åŠ©æ¨¡å¼ (ai)</option>
        <option value="pure">âš¡ çº¯ç­–ç•¥æ¨¡å¼ (pure)</option>
      </select>
    </div>
    <div class="input-group">
      <label>äº¤æ˜“å“ç§ (symbol):</label>
      <input type="text" id="symbol" value="ETH-USDT-SWAP">
    </div>
    <button class="button" onclick="testSave()">ğŸ’¾ ä¿å­˜é…ç½®</button>
    <button class="button secondary" onclick="testLoad()">ğŸ“¥ åŠ è½½é…ç½®</button>
    <button class="button secondary" onclick="clearLog()">ğŸ—‘ï¸ æ¸…ç©ºæ—¥å¿—</button>
  </div>

  <div class="card">
    <h2>ğŸ“Š æµ‹è¯•ç»“æœ</h2>
    <div id="status"></div>
    <div class="log" id="log"></div>
  </div>

  <script>
    const API_URL = 'https://ly.ddg.org.cn/api/strategy/config';
    const DEFAULT_USER_ID = 'default';

    function log(message) {
      const logDiv = document.getElementById('log');
      const timestamp = new Date().toLocaleTimeString();
      logDiv.textContent += `[${timestamp}] ${message}\n`;
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    function setStatus(message, type = 'info') {
      const statusDiv = document.getElementById('status');
      statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
    }

    function clearLog() {
      document.getElementById('log').textContent = '';
      document.getElementById('status').innerHTML = '';
    }

    async function testSave() {
      clearLog();
      log('ğŸ§ª å¼€å§‹æµ‹è¯•ä¿å­˜é…ç½®...');
      log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');

      const tradingMode = document.getElementById('tradingMode').value;
      const symbol = document.getElementById('symbol').value;

      const config = {
        basicConfig: {
          symbol: symbol,
          strategyType: 'sar_macd',
          tradingStyle: 'conservative',
          tradeDirection: 'both',
          directionTimeframe: 'daily',
          entryTimeframe: '15m',
          analysisInterval: 30,
          cooldownSeconds: 60,
          tradingMode: tradingMode  // âœ… æµ‹è¯•å­—æ®µ
        },
        buyConfig: {
          logicType: 'and',
          minConfidence: 70,
          conditions: [
            { id: 'sar_daily', name: 'æ—¥çº¿SAR', enabled: true },
            { id: 'sar_15m', name: '15åˆ†é’ŸSAR', enabled: true },
            { id: 'macd_15m', name: '15åˆ†é’ŸMACD', enabled: true }
          ]
        },
        sellConfig: {
          logicType: 'or',
          stopLossEnabled: true,
          takeProfitEnabled: true,
          takeProfitPercent: 1.0,
          stopLossPercent: 0.2
        },
        fundConfig: {
          mode: 'accountBalance',
          fixedAmount: 100,
          balancePercent: 40,
          leverage: 5,
          marginMode: 'cross',
          maxPositions: 3
        }
      };

      log('ğŸ“¤ å‡†å¤‡ä¿å­˜é…ç½®:');
      log(`   tradingMode: "${config.basicConfig.tradingMode}"`);
      log(`   symbol: "${config.basicConfig.symbol}"`);

      try {
        log('ğŸ“¡ å‘é€ POST è¯·æ±‚...');
        log(`   URL: ${API_URL}`);
        log(`   userId: ${DEFAULT_USER_ID}`);

        const response = await fetch(API_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            userId: DEFAULT_USER_ID,
            config: config
          })
        });

        log('ğŸ“¡ æ”¶åˆ°å“åº”...');
        const result = await response.json();
        log('ğŸ“Š å“åº”æ•°æ®:');
        log(JSON.stringify(result, null, 2));

        if (result.success) {
          setStatus('âœ…âœ…âœ… ä¿å­˜æˆåŠŸï¼tradingMode å·²ä¿å­˜ âœ…âœ…âœ…', 'success');
          log('âœ… ä¿å­˜æˆåŠŸï¼');
          log(`   âœ… tradingMode = "${tradingMode}"`);
        } else {
          setStatus(`âŒ ä¿å­˜å¤±è´¥: ${result.error}`, 'error');
          log(`âŒ ä¿å­˜å¤±è´¥: ${result.error}`);
        }
      } catch (error) {
        setStatus(`âŒ è¯·æ±‚å¼‚å¸¸: ${error.message}`, 'error');
        log(`âŒ è¯·æ±‚å¼‚å¸¸: ${error.message}`);
      }

      log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
    }

    async function testLoad() {
      clearLog();
      log('ğŸ§ª å¼€å§‹æµ‹è¯•åŠ è½½é…ç½®...');
      log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');

      try {
        log('ğŸ“¡ å‘é€ GET è¯·æ±‚...');
        log(`   URL: ${API_URL}?userId=${DEFAULT_USER_ID}`);

        const response = await fetch(`${API_URL}?userId=${DEFAULT_USER_ID}`);
        const result = await response.json();

        log('ğŸ“¡ æ”¶åˆ°å“åº”...');
        log('ğŸ“Š å“åº”æ•°æ®:');
        log(JSON.stringify(result, null, 2));

        if (result.success && result.data) {
          const tradingMode = result.data.basicConfig?.tradingMode;
          const symbol = result.data.basicConfig?.symbol;

          log('âœ… åŠ è½½æˆåŠŸï¼');
          log(`   ğŸ“Š symbol: "${symbol}"`);
          log(`   ğŸ“Š tradingMode: "${tradingMode}"`);

          // æ›´æ–°è¾“å…¥æ¡†
          if (tradingMode) {
            document.getElementById('tradingMode').value = tradingMode;
            log(`   âœ… å·²æ›´æ–°è¾“å…¥æ¡†: tradingMode = "${tradingMode}"`);
          }
          if (symbol) {
            document.getElementById('symbol').value = symbol;
          }

          setStatus(`âœ… åŠ è½½æˆåŠŸï¼tradingMode = "${tradingMode}"`, 'success');
        } else {
          setStatus(`âŒ åŠ è½½å¤±è´¥: ${result.error || 'æœªæ‰¾åˆ°é…ç½®'}`, 'error');
          log(`âŒ åŠ è½½å¤±è´¥: ${result.error || 'æœªæ‰¾åˆ°é…ç½®'}`);
        }
      } catch (error) {
        setStatus(`âŒ è¯·æ±‚å¼‚å¸¸: ${error.message}`, 'error');
        log(`âŒ è¯·æ±‚å¼‚å¸¸: ${error.message}`);
      }

      log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
    }

    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åŠ è½½ä¸€æ¬¡é…ç½®
    window.addEventListener('load', () => {
      log('ğŸš€ é¡µé¢å·²åŠ è½½');
      log('ğŸ’¡ æç¤º: ç‚¹å‡»"åŠ è½½é…ç½®"æŒ‰é’®æŸ¥çœ‹å½“å‰æ•°æ®åº“ä¸­çš„é…ç½®');
      log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
    });
  </script>
</body>
</html>
